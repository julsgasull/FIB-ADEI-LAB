# Chunk 72
barplot(table(iouts),main="Outliers per individual Barplot",col="darkslateblue")
# Chunk 73
total_missings <- 0; total_outliers <- 0; total_errors <- 0;
for (m in imis) {total_missings <- total_missings + m}
for (o in iouts) {total_outliers <- total_outliers + o}
for (e in ierrs) {total_errors <- total_errors + e}
# Chunk 74
total_missings
total_outliers
total_errors
# Chunk 75
df$qual.lpep_pickup_datetime <- NULL
df$qual.lpep_dropoff_datetime <- NULL
names(df)
# Chunk 76
library(missMDA)
# Chunk 77
df <- df[!is.na(df$q.target.total_amount),]
names(df)
vars_quantitatives <- names(df)[c(4,5,6,7,8,9,10,11,12,13,14,15,16,21,22,23)]
#  [1] "q.pickup_longitude"      "q.pickup_latitude"
#  [3] "q.dropoff_longitude"     "q.dropoff_latitude"
#  [5] "q.passenger_count"       "q.trip_distance"
#  [7] "q.fare_amount"           "q.extra"
#  [9] "q.mta_tax"               "q.tip_amount"
# [11] "q.tolls_amount"          "q.improvement_surcharge"
# [13] "q.tlenkm"                "q.travel_time"
# [15] "q.espeed"
# Chunk 78
summary(df[,vars_quantitatives])
res.imputation<-imputePCA(df[,vars_quantitatives],ncp=5)
summary(res.imputation$completeObs)
# Chunk 79
summary(res.imputation$completeObs[,"q.pickup_longitude"])
# Chunk 80
summary(res.imputation$completeObs[,"q.pickup_latitude"])
# Chunk 81
summary(res.imputation$completeObs[,"q.dropoff_longitude"])
# Chunk 82
summary(res.imputation$completeObs[,"q.dropoff_latitude"])
# Chunk 83
df$f.passenger_groups[res.imputation$completeObs[,"q.passenger_count"]  == 1] = "passenger_single"
df$f.passenger_groups[res.imputation$completeObs[,"q.passenger_count"] > 1 & res.imputation$completeObs[,"q.passenger_count"] <= 2] = "passenger_couple"
df$f.passenger_groups[res.imputation$completeObs[,"q.passenger_count"] >= 3] = "passenger_group"
df$f.passenger_groups <- factor(df$f.passenger_groups)
# Chunk 84
barplot(table(df$f.passenger_groups),main="passenger_groups barplot",col="darkslateblue")
# Chunk 85
ll<-which(res.imputation$completeObs[,"q.trip_distance"] < 0)
res.imputation$completeObs[ll,"q.trip_distance"] <- 1
ll<-which(res.imputation$completeObs[,"q.trip_distance"] > 30)
res.imputation$completeObs[ll,"q.trip_distance"] <- 30
# Chunk 86
ll<-which(res.imputation$completeObs[,"q.fare_amount"] > 60)
res.imputation$completeObs[ll,"q.fare_amount"] <- 60
# Chunk 87
table(df$q.extra)
df$f.extra[df$q.extra == 0] = 0
df$f.extra[df$q.extra > 0] = 1
df$f.extra<-factor(df$f.extra, labels=c("extra_no","extra_yes"))
# Chunk 88
barplot(table(df$f.extra),main="extra barplot",col="darkslateblue")
# Chunk 89
table(df$q.mta_tax)
df$f.mta_tax<-factor(df$q.mta_tax, labels =c("mta_no","mta_yes"))
# Chunk 90
barplot(table(df$q.mta_tax),main="mta_tax barplot",col="darkslateblue")
# Chunk 91
ll<-which(res.imputation$completeObs[,"q.tip_amount"] > 17)
res.imputation$completeObs[ll,"q.tip_amount"] <- 17
# Chunk 92
df$f.target.tip_is_given[(res.imputation$completeObs[,"q.tip_amount"] > 0)] = "tip_yes"
df$f.target.tip_is_given[(res.imputation$completeObs[,"q.tip_amount"] == 0)] = "tip_no"
df$f.target.tip_is_given <- factor(df$f.target.tip_is_given)
summary(df$f.target.tip_is_given)
# Chunk 93
ll<-which(res.imputation$completeObs[,"q.tolls_amount"] < 0)
res.imputation$completeObs[ll,"q.tolls_amount"] <- 0
df$f.paid_tolls[res.imputation$completeObs[,"q.tolls_amount"] == 0] = "tolls_no"
df$f.paid_tolls[res.imputation$completeObs[,"q.tolls_amount"] > 0] = "tolls_yes"
df$f.paid_tolls <- factor(df$f.paid_tolls)
# Chunk 94
table(df$q.improvement_surcharge)
df$f.improvement_surcharge<-factor(df$q.improvement_surcharge, labels=c("improvement_no","improvement_yes"))
# Chunk 95
barplot(table(df$f.improvement_surcharge),main="improvement_surcharge barplot",col="darkslateblue")
# Chunk 96
ll<-which(res.imputation$completeObs[,"q.tlenkm"] <= 1)
res.imputation$completeObs[ll,"q.tlenkm"] <- 1
ll<-which(res.imputation$completeObs[,"q.tlenkm"] > 48.28)
res.imputation$completeObs[ll,"q.tlenkm"] <- 48.28
# Chunk 97
ll<-which(res.imputation$completeObs[,"q.tlenkm"] > 60)
res.imputation$completeObs[ll,"q.tlenkm"] <- 60
# Chunk 98
ll<-which(res.imputation$completeObs[,"q.espeed"] < 3)
res.imputation$completeObs[ll,"q.espeed"] <- 3
ll<-which(res.imputation$completeObs[,"q.espeed"] > 55)
res.imputation$completeObs[ll,"q.espeed"] <- 55
# Chunk 99
df[,vars_quantitatives] <- res.imputation$completeObs
# Chunk 100
vars_categorical<-names(df)[c(1,2,3,17,18,20,26,27,28,29,30,31,32)]
summary(df[,vars_categorical])
res.input<-imputeMCA(df[,vars_categorical],ncp=10)
summary(res.input$completeObs)
# Chunk 101
df[,vars_categorical] <- res.input$completeObs
# Chunk 102
df$f.dist[df$q.trip_distance<=1.6] = "(0, 1.6]"
df$f.dist[(df$q.trip_distance>1.6) & (df$q.trip_distance<=3)] = "(1.6, 3]"
df$f.dist[(df$q.trip_distance>3) & (df$q.trip_distance<=5.5)] = "(3, 5.5]"
df$f.dist[(df$q.trip_distance>5.5) & (df$q.trip_distance<=30)] = "(5.5, 30]"
df$f.dist<-factor(df$f.dist)
# Chunk 103
df$f.hour[(df$q.hour>=17) & (df$q.hour<18)] = "17"
df$f.hour[(df$q.hour>=18) & (df$q.hour<19)] = "18"
df$f.hour[(df$q.hour>=19) & (df$q.hour<20)] = "19"
df$f.hour[(df$q.hour>=20) & (df$q.hour<21)] = "20"
df$f.hour[(df$q.hour>=21) & (df$q.hour<22)] = "21"
df$f.hour[(df$q.hour>=22) & (df$q.hour<23)] = "22"
df$f.hour[(df$q.hour<17)] = "other"
df$f.hour[(df$q.hour>=23)] = "other"
df$f.hour<-factor(df$f.hour)
# Chunk 104
df$f.espeed[(df$q.espeed>=3) & (df$q.espeed<20)]  = "[03,20)"
df$f.espeed[(df$q.espeed>=20) & (df$q.espeed<40)] = "[20,40)"
df$f.espeed[(df$q.espeed>=40) & (df$q.espeed<=55)] = "[40,55]"
df$f.espeed<-factor(df$f.espeed)
# Chunk 105
library(mvoutlier)
library(FactoMineR)
vars_quantitatives_no_coords <- names(df)[c(8,9,10,11,12,13,14,15,16,21,22,23)]
res <- cor(df[,vars_quantitatives_no_coords])
round(res, 2)
# Chunk 106
library(corrplot)
corrplot(res,method="square",type="upper",tl.col="black",tl.cex=0.75,)
# Chunk 107
library(mvoutlier)
library(chemometrics)
multivariant_outliers <- Moutlier(df[, c(9,10,16,23)], quantile = 0.995)
multivariant_outliers$cutoff
par(mfrow=c(1,1))
plot(multivariant_outliers$md, multivariant_outliers$rd, type="n")
text(multivariant_outliers$md, multivariant_outliers$rd, labels=rownames(df[, c(9,10,16,23)]), cex=0.5)
# Chunk 108
df[which(row.names(df)=="1208612"), 1:35]
# Chunk 109
df <- subset(df, !(multivariant_outliers$md>10 | multivariant_outliers$rd>60))
multivariant_outliers <- Moutlier(df[, c(9,10,16,23)], quantile = 0.995)
par(mfrow=c(1,1))
plot(multivariant_outliers$md, multivariant_outliers$rd, type="n")
text(multivariant_outliers$md, multivariant_outliers$rd, labels=rownames(df[, c(9,10,16,23)]), cex=0.5)
# Chunk 110
library(FactoMineR)
summary(df$q.target.total_amount)
# Chunk 111
vars_res<-names(df)[c(16,30)]
vars_quantitatives<-names(df)[c(8:15,21:23)]
vars_categorical<-names(df)[c(1:3,17,18,20,26:29,31,32)]
res.condes <- condes(df[, c(vars_res,vars_quantitatives, vars_categorical)],1)
# Chunk 112
res.condes$quanti
# Chunk 113
res.condes$quali
# Chunk 114
res.condes$category
# Chunk 115
res.catdes <- catdes(df[, c(vars_res,vars_quantitatives, vars_categorical)],2)
# Chunk 116
res.catdes$test.chi2
# Chunk 117
res.catdes$quanti.var
# Chunk 118
res.catdes$category
# Chunk 119
df$f.store_and_fwd_flag <- NULL
# Chunk 120
names(df)
vars_res<-names(df)[c(15,29)]
vars_quantitatives<-names(df)[c(3,4,5,6,7,8,9,10,12,20,21,22)]
vars_categorical<-names(df)[c(1,2,16,17,19,25,30)]
# Chunk 121
library(FactoMineR)
res.pca <- PCA(df[,c(1,2,3,4,5,6,7,8,9,10,12,13,15,16,17,19,21,22,25,26,29)],quanti.sup=c(3:6,13),quali.sup=c(1,2,14:16,19:21))
# Chunk 122
eigenvalues <- res.pca$eig
head(eigenvalues[, 1:3])
# Chunk 123
fviz_screeplot(res.pca,addlabels=TRUE,ylim=c(0,50),barfill="darkslateblue",barcolor="darkslateblue",linecolor="skyblue1")
# Chunk 124
fviz_pca_ind(res.pca, col.ind="contrib", geom = "point") +
scale_color_gradient2(low="darkslateblue", mid="white",
high="red", midpoint=0.40)
# Chunk 125
rang<-order(res.pca$ind$coord[,1])
contrib.extremes<-c(row.names(df)[rang[1]], row.names(df)[rang[length(rang)]])
contrib.extremes<-c(row.names(df)[rang[1:10]], row.names(df)[rang[(length(rang)-10):length(rang)]])
fviz_pca_ind(res.pca, select.ind = list(names=contrib.extremes))
# Chunk 126
df[which(row.names(df) %in% row.names(df)[rang[length(rang)]]), 1:34]
df[which(row.names(df) %in% row.names(df)[rang[1]]),1:34]
# Chunk 127
rang<-order(res.pca$ind$coord[,2])
contrib.extremes<-c(row.names(df)[rang[1]], row.names(df)[rang[length(rang)]])
contrib.extremes<-c(row.names(df)[rang[1:10]], row.names(df)[rang[(length(rang)-10):length(rang)]])
fviz_pca_ind(res.pca, select.ind = list(names=contrib.extremes))
# Chunk 128
df[which(row.names(df) %in% row.names(df)[rang[length(rang)]]), 1:34]
df[which(row.names(df) %in% row.names(df)[rang[1]]),1:34]
# Chunk 129
res.des <- dimdesc(res.pca)
# Chunk 130
fviz_contrib(res.pca,fill="darkslateblue",color="darkslateblue",choice="var",axes=1,top=5)
res.des$Dim.1
# Chunk 131
fviz_contrib(res.pca,fill="darkslateblue",color="darkslateblue",choice="var",axes=2,top=5)
res.des$Dim.2
# Chunk 132
fviz_contrib(res.pca,fill="darkslateblue",color="darkslateblue",choice="var",axes=3,top=5)
res.des$Dim.3
# Chunk 133
plot(res.pca$ind$coord[,1],res.pca$ind$coord[,2],pch=19,col="grey30")
points(res.pca$quali.sup$coord[,1],res.pca$quali.sup$coord[,2],pch=15,col="cadetblue1")
lines(res.pca$quali.sup$coord[3:4,1],res.pca$quali.sup$coord[3:4,2],lwd=2,lty=2,col="coral")
text(res.pca$quali.sup$coord[,1],res.pca$quali.sup$coord[,2],labels=names(res.pca$quali.sup$coord[,1]),col="cadetblue1",cex=0.5)
# Chunk 134
res.hcpc <- HCPC(res.pca,nb.clust=5, order=TRUE)
# Chunk 135
table(res.hcpc$data.clust$clust)
barplot(table(res.hcpc$data.clust$clust), col="darkslateblue", border="darkslateblue", main="[hierarchical] #observations/cluster")
# Chunk 136
res.hcpc$desc.var$test.chi2
# Chunk 137
res.hcpc$desc.var$category
# Chunk 138
res.hcpc$desc.var$quanti.var
# Chunk 139
res.hcpc$desc.var$quanti
# Chunk 140
res.hcpc$desc.ind$para
# Chunk 141
res.hcpc$desc.ind$dist
# Chunk 142
para1<-which(rownames(res.pca$ind$coord)%in%names(res.hcpc$desc.ind$para[[1]]))
dist1<-which(rownames(res.pca$ind$coord)%in%names(res.hcpc$desc.ind$dist[[1]]))
para2<-which(rownames(res.pca$ind$coord)%in%names(res.hcpc$desc.ind$para[[2]]))
dist2<-which(rownames(res.pca$ind$coord)%in%names(res.hcpc$desc.ind$dist[[2]]))
para3<-which(rownames(res.pca$ind$coord)%in%names(res.hcpc$desc.ind$para[[3]]))
dist3<-which(rownames(res.pca$ind$coord)%in%names(res.hcpc$desc.ind$dist[[3]]))
para4<-which(rownames(res.pca$ind$coord)%in%names(res.hcpc$desc.ind$para[[4]]))
dist4<-which(rownames(res.pca$ind$coord)%in%names(res.hcpc$desc.ind$dist[[4]]))
para5<-which(rownames(res.pca$ind$coord)%in%names(res.hcpc$desc.ind$para[[5]]))
dist5<-which(rownames(res.pca$ind$coord)%in%names(res.hcpc$desc.ind$dist[[5]]))
plot(res.pca$ind$coord[,1],res.pca$ind$coord[,2],col="grey50",cex=0.5,pch=16)
points(res.pca$ind$coord[para1,1],res.pca$ind$coord[para1,2],col="blue",cex=1,pch=16)
points(res.pca$ind$coord[dist1,1],res.pca$ind$coord[dist1,2],col="chartreuse3",cex=1,pch=16)
points(res.pca$ind$coord[para2,1],res.pca$ind$coord[para2,2],col="blue",cex=1,pch=16)
points(res.pca$ind$coord[dist2,1],res.pca$ind$coord[dist2,2],col="darkorchid3",cex=1,pch=16)
points(res.pca$ind$coord[para3,1],res.pca$ind$coord[para3,2],col="blue",cex=1,pch=16)
points(res.pca$ind$coord[dist3,1],res.pca$ind$coord[dist3,2],col="firebrick3",cex=1,pch=16)
points(res.pca$ind$coord[para4,1],res.pca$ind$coord[para4,2],col="blue",cex=1,pch=16)
points(res.pca$ind$coord[dist4,1],res.pca$ind$coord[dist4,2],col="palevioletred3",cex=1,pch=16)
points(res.pca$ind$coord[para5,1],res.pca$ind$coord[para5,2],col="blue",cex=1,pch=16)
points(res.pca$ind$coord[dist5,1],res.pca$ind$coord[dist5,2],col="royalblue1",cex=1,pch=16)
# Chunk 143
((res.hcpc$call$t$within[1]-res.hcpc$call$t$within[5])/res.hcpc$call$t$within[1])*100
# Chunk 144
((res.hcpc$call$t$within[1]-res.hcpc$call$t$within[9])/res.hcpc$call$t$within[1])*100
# Chunk 145
res.hcpc$call$t$inert.gain[1:5]
df$hcpck<-res.hcpc$data.clust$clust
# Chunk 146
res.pca <- PCA(df[,c(1,2,3,4,5,6,7,8,9,10,12,13,15,16,17,19,21,22,25,26)],quanti.sup=c(3:6,13),quali.sup=c(1,2,14:16,19:20),ncp=5,graph=FALSE)
ppcc<-res.pca$ind$coord[,1:3] ## 3 components principals (kaiser)
dim(ppcc)
# Chunk 147
library("factoextra")
# fviz_nbclust(ppcc, kmeans, method = "gap_stat") ## !!!!Descomentar pel deliverable, triga molt.
# Chunk 148
dist<-dist(ppcc)
kc<-kmeans(dist, 5, iter.max=30, trace=TRUE) #caclulate the distances, it turns into a matrix
# Chunk 149
df$claKM<-0
df$claKM<-kc$cluster
df$claKM<-factor(df$claKM)
barplot(table(df$claKM),col="darkslateblue",border="darkslateblue",main="[k-means]#observations/cluster")
# Chunk 150
100*(kc$betweenss/kc$totss)
# Chunk 151
dim(df)
res.cat <-catdes(df,30)
res.cat
# Chunk 152
table(df$hcpck,df$claKM)
## we must do a relabel
df$hcpck<-factor(df$hcpck,labels=c("kHP-1","kHP-2","kHP-3","kHP-4","kHP-5"))
df$claKM<-factor(df$claKM,levels=c(2,4,5,3,1),labels=c("kKM-2","kKM-4","kKM-5","kKM-3","kKM-1"))
tt<-table(df$hcpck,df$claKM); tt
100*sum(diag(tt)/sum(tt))
# Chunk 153
df$f.cost[df$q.target.total_amount<=8] = "[0,8]"
df$f.cost[(df$q.target.total_amount>8) & (df$q.target.total_amount<=11)] = "(8,11]"
df$f.cost[(df$q.target.total_amount>11) & (df$q.target.total_amount<=18)] = "(11,18]"
df$f.cost[(df$q.target.total_amount>18) & (df$q.target.total_amount<= 30)] = "(18,30]"
df$f.cost[(df$q.target.total_amount>30) & (df$q.target.total_amount<= 50)] = "(30,50]"
df$f.cost[df$q.target.total_amount>50] = "(50,129)"
df$f.cost<-factor(df$f.cost)
table(df$f.cost)
# Chunk 154
tt<-table(df[,c("f.cost","f.passenger_groups")]);tt
chisq.test(tt,  simulate.p.value = TRUE) #to see if the rows and columns are independents. H0: Rows and columns are independent
# Chunk 155
res.ca <- CA(tt)
# Chunk 156
summary(res.ca)
# Chunk 157
df$f.travel_time[df$q.travel_time<=5] = "[0,5]"
df$f.travel_time[(df$q.travel_time>5) & (df$q.travel_time<=10)] = "(5,10]"
df$f.travel_time[(df$q.travel_time>10) & (df$q.travel_time<=15)] = "(10,15]"
df$f.travel_time[(df$q.travel_time>15) & (df$q.travel_time<= 20)] = "(15,20]"
df$f.travel_time[(df$q.travel_time>20) & (df$q.travel_time<= 70)] = "(20,60]"
df$f.travel_time<-factor(df$f.travel_time)
table(df$f.travel_time)
# Chunk 158
new_f.cost <- ordered(df$f.cost, levels= c("[0,8]", "(8,11]", "(11,18]", "(18,30]", "(30,50]","(50,129)"))
new_f.travel_time <- ordered(df$f.travel_time, levels= c("[0,5]", "(5,10]", "(10,15]", "(15,20]","(20,60]"))
tt<-table(new_f.cost, new_f.travel_time);tt
chisq.test(tt) #to see if the rows and columns are independents. H0: Rows and columns are independent
# Chunk 159
res.ca <- CA(tt)
plot(res.ca$row$coord[,1],res.ca$row$coord[,2],pch=19,col="blue",xlim=c(-1.5,1.5),ylim=c(-1.5,1.5),xlab="Axis 1",ylab="Axis 2", main="CA f.cost vs f.travel_time")
points(res.ca$col$coord[,1],res.ca$col$coord[,2],lwd=2,col="red")
text(res.ca$row$coord[,1],res.ca$row$coord[,2],lwd=2,col="blue",labels=levels(df$f.cost))
text(res.ca$col$coord[,1],res.ca$col$coord[,2],lwd=2,col="red",labels=levels(df$f.travel_time))
lines(res.ca$row$coord[,1],res.ca$row$coord[,2],lwd=2,col="blue")
lines(res.ca$col$coord[,1],res.ca$col$coord[,2],lwd=2,col="red")
# Chunk 160
summary(res.ca)
# Chunk 161
mean(res.ca$eig[,1])
# Chunk 162
library(FactoMineR)
library(factoextra)
# Chunk 163
names(df[,c(1,2,15,16,17,19,25,29,26,37)])
res.mca <- MCA(df[,c(1,2,15,16,17,19,25,29,26,37)],quanti.sup=c(3),quali.sup=c(8,10),graph=FALSE)
# Chunk 164
fviz_mca_var(res.mca, choice="quanti.sup", repel=TRUE, ggtheme=theme_minimal())
# Chunk 165
fviz_mca_ind(res.mca,geom=c("point"),col.ind="darkslateblue")
# Chunk 166
mean(res.mca$eig[,1])
head(get_eigenvalue(res.mca), 10)
# Chunk 167
fviz_screeplot(res.mca,addlabels=TRUE,ylim=c(0,20),barfill="darkslateblue",barcolor="darkslateblue",linecolor="skyblue1")
# Chunk 168
fviz_mca_ind(res.mca,geom=c("point"),col.ind="contrib",gradient.cols=c("darkslateblue", "red"))
# Chunk 169
fviz_mca_ind(res.mca, label="none", habillage="f.vendor_id", palette=c("darkslateblue", "red"))
fviz_mca_ind(res.mca, label="none", habillage="f.rate_code_id", palette=c("darkslateblue", "red"))
fviz_mca_ind(res.mca, label="none", habillage="f.trip_type", palette=c("darkslateblue", "red"))
# Chunk 170
fviz_mca_var(res.mca, choice="mca.cor", repel=TRUE)
# Chunk 171
fviz_mca_var(res.mca, repel=TRUE)
# Chunk 172
res.desc <- dimdesc(res.mca, axes = c(1,2))
# Chunk 173
res.desc[[1]]
# Chunk 174
res.desc[[2]]
# Chunk 175
names(df[,c(1:38)])
res.mca_all <- MCA(
df[,c(1:38)],
quanti.sup=c(3,4,5,6,7,8,9,10,11,12,13,14,15,18,20,21,22),
quali.sup=c(26,37),
graph=FALSE
)
# Chunk 176
res.desc <- dimdesc(res.mca_all, axes = c(1,2))
# Chunk 177
res.desc[[1]]
# Chunk 178
res.desc[[2]]
# Chunk 179
res.hcpcMCA <- HCPC(res.mca,nb.clust=5,order=TRUE)
# Chunk 180
table(res.hcpcMCA$data.clust$clust)
barplot(table(res.hcpcMCA$data.clust$clust), col="darkslateblue", border="darkslateblue", main="[hierarchical from mca] #observations/cluster")
# Chunk 181
res.hcpcMCA$desc.var$test.chi2
# Chunk 182
res.hcpcMCA$desc.var$category
# Chunk 183
res.hcpcMCA$desc.var$quanti.var
# Chunk 184
res.hcpcMCA$desc.var$quanti
# Chunk 185
## ( between sum of squares / total sum of squares ) * 100
((res.hcpcMCA$call$t$within[1]-res.hcpcMCA$call$t$within[5])/res.hcpcMCA$call$t$within[1])*100
# Chunk 186
((res.hcpcMCA$call$t$within[1]-res.hcpcMCA$call$t$within[13])/res.hcpcMCA$call$t$within[1])*100
# Chunk 187
res.hcpcMCA$desc.ind$para  ## representative individuals of each cluster
# Chunk 188
res.hcpcMCA$desc.ind$dist  ## individuals distant from each cluster
# Chunk 189
## characteristic individuals
para1<-which(rownames(res.mca$ind$coord)%in%names(res.hcpcMCA$desc.ind$para[[1]]))
dist1<-which(rownames(res.mca$ind$coord)%in%names(res.hcpcMCA$desc.ind$dist[[1]]))
para2<-which(rownames(res.mca$ind$coord)%in%names(res.hcpcMCA$desc.ind$para[[2]]))
dist2<-which(rownames(res.mca$ind$coord)%in%names(res.hcpcMCA$desc.ind$dist[[2]]))
para3<-which(rownames(res.mca$ind$coord)%in%names(res.hcpcMCA$desc.ind$para[[3]]))
dist3<-which(rownames(res.mca$ind$coord)%in%names(res.hcpcMCA$desc.ind$dist[[3]]))
para4<-which(rownames(res.mca$ind$coord)%in%names(res.hcpcMCA$desc.ind$para[[4]]))
dist4<-which(rownames(res.mca$ind$coord)%in%names(res.hcpcMCA$desc.ind$dist[[4]]))
para5<-which(rownames(res.mca$ind$coord)%in%names(res.hcpcMCA$desc.ind$para[[5]]))
dist5<-which(rownames(res.mca$ind$coord)%in%names(res.hcpcMCA$desc.ind$dist[[5]]))
plot(res.mca$ind$coord[,1],res.mca$ind$coord[,2],col="grey50",cex=0.5,pch=16)
points(res.mca$ind$coord[para1,1],res.mca$ind$coord[para1,2],col="blue",cex=1,pch=16)
points(res.mca$ind$coord[dist1,1],res.mca$ind$coord[dist1,2],col="chartreuse3",cex=1,pch=16)
points(res.mca$ind$coord[para2,1],res.mca$ind$coord[para2,2],col="blue",cex=1,pch=16)
points(res.mca$ind$coord[dist2,1],res.mca$ind$coord[dist2,2],col="darkorchid3",cex=1,pch=16)
points(res.mca$ind$coord[para3,1],res.mca$ind$coord[para3,2],col="blue",cex=1,pch=16)
points(res.mca$ind$coord[dist3,1],res.mca$ind$coord[dist3,2],col="firebrick3",cex=1,pch=16)
points(res.mca$ind$coord[para4,1],res.mca$ind$coord[para4,2],col="blue",cex=1,pch=16)
points(res.mca$ind$coord[dist4,1],res.mca$ind$coord[dist4,2],col="palevioletred3",cex=1,pch=16)
points(res.mca$ind$coord[para5,1],res.mca$ind$coord[para5,2],col="blue",cex=1,pch=16)
points(res.mca$ind$coord[dist5,1],res.mca$ind$coord[dist5,2],col="royalblue1",cex=1,pch=16)
# Chunk 190
df$hcpckMCA<-res.hcpcMCA$data.clust$clust
## With Hierarchical Clustering (PCA)
table(df$hcpck,df$hcpckMCA)
df$hcpckMCA_hcpck<-factor(
df$hcpckMCA,
levels=c(3,2,1,4,5),
labels=c("kHPmca-3","kHPmca-2","kHPmca-1","kHPmca-4","kHPmca-5")
)
tt1<-table(df$hcpck,df$hcpckMCA_hcpck); tt1
100*sum(diag(tt1)/sum(tt1))
# Chunk 191
## With k-means (PCA)
table(df$claKM, df$hcpckMCA)
df$hcpckMCA_claKM<-factor(
df$hcpckMCA,
levels=c(3,4,1,2,5),
labels=c("kHPmca-3","kHPmca-4","kHPmca-1","kHPmca-2","kHPmca-5")
)
tt2<-table(df$claKM,df$hcpckMCA_claKM); tt
100*sum(diag(tt2)/sum(tt2))
# Chunk 192
## res.hcpc$desc.var$quanti.var  ## quantitative variables which characterizes the clusters
## ##                               Eta2       P-value
## ## q.target.total_amount  0.572312116  0.000000e+00
# Chunk 193
## res.cat <-catdes(df,30)
## res.cat
## ## Link between the cluster variable and the quantitative variables
## ## ================================================================
## ##                             Eta2       P-value
## ## q.target.total_amount 0.07543346  2.364785e-80
# Chunk 194
## ## res.hcpcMCA$desc.var$quanti.var  ## quantitative variables which characterizes the clusters
## ##                             Eta2      P-value
## ## q.target.total_amount 0.04259394 3.904378e-42
# Chunk 195
## res.hcpc$desc.var$category    ## description of each cluster by the categories
## ## $`1`
## ##                                         Cla/Mod      Mod/Cla    Global
## ## f.target.tip_is_given=tip_no           80.0278843 67.3906663 62.410268
## ## f.target.tip_is_given=tip_yes          64.2939815 32.6093337 37.589732
## #
## ## $`2`
## ##                                         Cla/Mod   Mod/Cla    Global
## ## nothing to see here
## ##
## ## $`3`
## ##                                         Cla/Mod    Mod/Cla    Global
## ## nothing to see here
## ##
## ## $`4`
## ##                                          Cla/Mod   Mod/Cla    Global
## ## f.target.tip_is_given=tip_yes          26.909722 58.197747 37.589732
## ## f.target.tip_is_given=tip_no           11.641687 41.802253 62.410268
## ##
## ## $`5`
## ##                                   Cla/Mod   Mod/Cla    Global
## ## nothing to see here
res.hcpc$desc.var$quanti.var
res.cat <-catdes(df,30)
names(df)
res.cat <-catdes(df,15)
## res.cat <-catdes(df,29)
## res.cat
## ## Link between the cluster variable and the quantitative variables
## ## ================================================================
## ##                             Eta2       P-value
## ## q.target.total_amount 0.07543346  2.364785e-80
```
res.cat <-catdes(df,29)
res.cat
res.hcpcMCA$desc.var$quanti.var
res.hcpc$desc.var$category
res.cat<-catdes(df,29)
res.cat
res.cat<-catdes(df,30)
res.cat
res.hcpcMCA$desc.var$category
